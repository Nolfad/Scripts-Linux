#!/usr/sbin/nft -f

flush ruleset

table inet filter {
  # Conjunto de IPs bloqueados
  set blocklist {
    type ipv4_addr
    flags interval
    elements = { 125.141.123.152 }   # adicione mais IPs aqui se quiser
  }

  # Conjunto de portas UDP usadas pelo SCUM
  set scum_udp_ports {
    type inet_service;
    elements = { 7777, 7778, 7779, 27015 }   # ajuste às portas que seu SCUM realmente usa
  }

  # Conjunto de portas TCP permitidas (ex.: query, rcon, etc.)
  set scum_tcp_ports {
    type inet_service;
    elements = { 7779 }   # adicione mais se precisar, ex.: 27015
  }

  chain input {
    type filter hook input priority 0; policy drop;

    # Permitir tráfego local
    iif "lo" accept

    # Permitir conexões já estabelecidas/relacionadas
    ct state established,related accept

    # Diagnóstico/rede (evita blackhole de MTU)
    ip protocol icmp accept
    ip6 nexthdr icmpv6 accept


    # Bloquear todos IPs da blocklist
    ip saddr @blocklist drop

    # Permitir SCUM (UDP)
    udp dport @scum_udp_ports accept

    # Permitir SCUM (TCP)
    tcp dport @scum_tcp_ports accept

    # (Opcional) log de drops
    limit rate 5/minute counter log prefix "nft-drop " level info
  }

  chain forward {
    type filter hook forward priority 0; policy drop;
  }

  chain output {
    type filter hook output priority 0; policy accept;
  }
}
